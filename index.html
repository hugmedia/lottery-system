<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>วันนี้รวย...</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Prompt:wght@400;500&display=swap');
        body {
            font-family: 'Prompt', Arial, sans-serif;
            font-weight: 400;
            margin: 0;
            padding: 20px;
            background-color: #f7f7f7;
            color: #333;
            font-size: clamp(14px, 2.5vw, 16px);
        }
        .container {
            background-color: #fff;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            max-width: min(90vw, 600px);
            margin: 0 auto;
        }
        h1 {
            font-family: 'Prompt', Arial, sans-serif;
            font-weight: 500;
            font-size: clamp(20px, 4vw, 24px);
            text-align: center;
            margin-bottom: 25px;
            color: #222;
        }
        .form-group {
            margin-bottom: 18px;
        }
        label {
            font-family: 'Prompt', Arial, sans-serif;
            font-weight: 400;
            display: block;
            font-size: clamp(12px, 2.2vw, 14px);
            margin-bottom: 8px;
            color: #444;
        }
        input[type="text"], input[type="date"], select {
            font-family: 'Prompt', Arial, sans-serif;
            font-weight: 400;
            width: 100%;
            padding: 10px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            font-size: clamp(12px, 2.2vw, 14px);
            background-color: #fafafa;
            box-sizing: border-box;
            transition: border-color 0.2s, background-color 0.2s;
        }
        input:focus, select:focus {
            outline: none;
            border-color: #4CAF50;
            background-color: #fff;
        }
        button {
            font-family: 'Prompt', Arial, sans-serif;
            font-weight: 500;
            background-color: #4CAF50;
            color: #fff;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-size: clamp(14px, 2.5vw, 16px);
            cursor: pointer;
            width: 100%;
            transition: background-color 0.2s;
        }
        button:hover {
            background-color: #45a049;
        }
        #result {
            font-family: 'Prompt', Arial, sans-serif;
            font-weight: 400;
            margin-top: 20px;
            padding: 15px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            background-color: #fafafa;
            font-size: clamp(12px, 2.2vw, 14px);
            display: none;
        }
        .success-message {
            font-family: 'Prompt', Arial, sans-serif;
            font-weight: 400;
            display: none;
            position: fixed;
            top: 20px;
            right: 20px;
            background-color: #4CAF50;
            color: #fff;
            padding: 8px 16px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            z-index: 1000;
            align-items: center;
            gap: 8px;
            font-size: clamp(12px, 2.2vw, 14px);
        }
        .success-message.show {
            display: flex;
        }
        .success-icon {
            width: 16px;
            height: 16px;
            background-color: #fff;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #4CAF50;
            font-weight: bold;
            font-size: 10px;
        }
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            .container {
                padding: 15px;
            }
            .success-message {
                top: 10px;
                right: 10px;
                padding: 6px 12px;
            }
        }
        @media (max-width: 480px) {
            h1 {
                margin-bottom: 20px;
            }
            .form-group {
                margin-bottom: 15px;
            }
            button {
                padding: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>วันนี้รวย...</h1>
        <form id="lotteryForm">
            <div class="form-group">
                <label>งวดประจำวันที่</label>
                <input type="date" id="lotteryDate" required>
            </div>

            <div class="form-group">
                <label>ประเภทหวย</label>
                <select id="lotteryType" required>
                    <option value="">เลือกประเภท</option>
                    <option value="หัว-ท้าย">หัว-ท้าย (รางวัลที่ 1)</option>
                    <option value="หัว">หัว (3 ตัวหน้า รางวัลที่ 1)</option>
                    <option value="ท้าย">ท้าย (3 ตัวหลัง รางวัลที่ 1)</option>
                    <option value="2ตัวบน-ล่าง">2 ตัว บน-ล่าง</option>
                    <option value="2ตัวบน">2 ตัว บน</option>
                </select>
            </div>

            <div class="form-group">
                <label>ตัวเลข</label>
                <input type="text" id="numbers" inputmode="numeric" pattern="[0-9]*" placeholder="เช่น 123 หรือ 12" required>
            </div>

            <div class="form-group">
                <label>จำนวนเงิน (บาท)</label>
                <input type="text" id="amount" inputmode="numeric" pattern="[0-9]*" placeholder="เช่น 100" required>
            </div>

            <div class="form-group">
                <label>ชื่อผู้ซื้อ</label>
                <input type="text" id="buyerName" placeholder="กรอกชื่อผู้ซื้อ" required>
            </div>

            <button type="submit">บันทึกการซื้อ</button>
        </form>

        <div id="result"></div>
    </div>

    <div id="successMessage" class="success-message">
        <span class="success-icon">✓</span>
        <span>บันทึกสำเร็จ</span>
    </div>

    <script>
        // Web App URL จาก GAS
        const GOOGLE_SHEET_WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbyDPjnGQzW-rSlLGvxS20WwR8GkBmUy8362SLKKiT2uBPUV27cjbqZp0yx2yf8rdW3V/exec';

        document.getElementById('lotteryForm').addEventListener('submit', async function(e) {
            e.preventDefault();

            const lotteryDate = document.getElementById('lotteryDate').value;
            const lotteryType = document.getElementById('lotteryType').value;
            const numbers = document.getElementById('numbers').value;
            const amount = document.getElementById('amount').value;
            const buyerName = document.getElementById('buyerName').value;

            // ตรวจสอบว่าตัวเลขและจำนวนเงินเป็นตัวเลขเท่านั้น
            if (!/^\d+$/.test(numbers)) {
                alert('กรุณากรอกตัวเลขเท่านั้นในช่องตัวเลข');
                return;
            }
            if (!/^\d+$/.test(amount)) {
                alert('กรุณากรอกตัวเลขเท่านั้นในช่องจำนวนเงิน');
                return;
            }

            // ตรวจสอบความยาวตัวเลขตามประเภทหวย
            let isValid = true;
            if (lotteryType.includes('3ตัว') && !/^\d{3}$/.test(numbers)) {
                isValid = false;
                alert('กรุณากรอกตัวเลข 3 หลักสำหรับประเภทนี้');
            } else if (lotteryType.includes('2ตัว') && !/^\d{2}$/.test(numbers)) {
                isValid = false;
                alert('กรุณากรอกตัวเลข 2 หลักสำหรับประเภทนี้');
            }

            if (isValid) {
                // แปลงวันที่เป็นรูปแบบภาษาไทย
                const date = new Date(lotteryDate);
                const formattedDate = date.toLocaleDateString('th-TH', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                });

                const resultDiv = document.getElementById('result');
                resultDiv.style.display = 'block';
                resultDiv.innerHTML = `
                    <h3>รายละเอียดการซื้อ</h3>
                    <p><strong>งวดประจำวันที่:</strong> ${formattedDate}</p>
                    <p><strong>ประเภท:</strong> ${lotteryType}</p>
                    <p><strong>ตัวเลข:</strong> ${numbers}</p>
                    <p><strong>จำนวนเงิน:</strong> ${amount} บาท</p>
                    <p><strong>ผู้ซื้อ:</strong> ${buyerName}</p>
                    <p><strong>วันที่ซื้อ:</strong> ${new Date().toLocaleString('th-TH')}</p>
                `;

                // สำรองข้อมูลใน localStorage
                const backupData = {
                    lotteryDate: formattedDate,
                    lotteryType,
                    numbers,
                    amount,
                    buyerName,
                    timestamp: new Date().toLocaleString('th-TH')
                };
                const backups = JSON.parse(localStorage.getItem('lotteryBackups') || '[]');
                backups.push(backupData);
                localStorage.setItem('lotteryBackups', JSON.stringify(backups));

                // ส่งข้อมูลไป Google Sheets
                try {
                    const response = await fetch(GOOGLE_SHEET_WEB_APP_URL, {
                        method: 'POST',
                        mode: 'no-cors',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(backupData)
                    });

                    // แสดงข้อความบันทึกสำเร็จ
                    const successMessage = document.getElementById('successMessage');
                    successMessage.classList.add('show');
                    setTimeout(() => {
                        successMessage.classList.remove('show');
                    }, 3000);

                    // รีเซ็ตฟอร์ม
                    this.reset();
                } catch (error) {
                    console.error('Error sending data to Google Sheets:', error);
                    alert('เกิดข้อผิดพลาดในการบันทึกข้อมูลไปยัง Google Sheets กรุณาตรวจสอบ Web App URL หรือการตั้งค่า Google Apps Script ข้อมูลได้ถูกสำรองไว้ในเครื่องแล้ว');
                }
            }
        });
    </script>
</body>
</html>